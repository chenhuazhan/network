以下是“Nginx 到底该怎么学？”的主题纲要。

![img](https://mmbiz.qpic.cn/mmbiz_png/xabgupsPLbT5BDLUjaQcEcZp1PAicZ8ia5rOUYiaicicVKjGTRrFCd7Zz9EicU8I8xTRM8micW88fkejdWG8ic2aLXibibzA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

作为工程师的我们，为什么要学 Nginx？

**第一点：Nginx 对整个架构的帮助是非常大的**。

2007 年，我从华为来到了腾讯的 QQ 空间，在数据开发组工作。当时 QQ 空间小组也就是十来个人，大概有一亿多用户，同时在线大约在三百万用户，承载在 Apache 和 C++ 开发的服务器上。因为当时腾讯有蛮低的 ARPO 值（每用户平均收入），每个用户贡献的收入是很少的，所以我们需要每台服务器尽量能够带来更多的价值，能服务更多的用户，就需要在 Apache 上做大量的优化。比如说把它的多进程改成多线程，很多初始化能一次解决的就不要初始化多次、调用多次等等。

**但是不管你怎么样做，总有点隔靴搔痒的感觉，你根本没办法做大幅度的优化，因为它的结构已经决定了这些问题的出现**。

2009 年我到了思科之后，也遇到了同样问题，但我开始接触 Nginx，发现用 Nginx 改造服务器之后，它大概有 10 倍这样数量级的性能提升。但对于 Apache，你对架构本身没有办法做很大的变动了。这就是我通过实际经历想表达的第一点。

**第二点：不能重复造轮子**。

什么叫不能重复造轮子？

大概 2014 年，我在阿里 VBC 网络的时候，用因特尔的 DBDT 技术解决方案，做了一个叫 SDN 软件自定义网络。当时我突然发现，你做一些比如网络设备相关东西的时候，它的技术迭代非常慢，而且技术相对保守一些。

这个到底是为什么呐？我现在想明白了，就是我们在互联网背景下，技术是模块依赖的，比如我用 Nginx 来开发，Nginx 的模块都是开放的，我可以基于别人的模块做进一步的开发。别人在 不断迭代模块的之后，我可以享受到优化的好处，这就是所谓的“站在巨人的肩膀上”。

**这也就是我想讲的：千万不要重复造轮子。如果 Nginx 能解决，或者说任何一个成熟的框架能解决问题的时候，不要再花时间自己做了**。

**第三点：还有好的架构**。

什么叫好的架构？

我是 2012 年 10 月份去的阿里云，做了架构师。ECS 当时是两个月迭代一次版本，我们团队全年通宵了 23 次，花了两年时间，把线上的五万台服务器重构成一个新的架构，大概是一个月就可以做迭代。

**好的架构真的很重要。Nginx 就是个好的架构**。

**好架构，就是你要有预见性**。比如 TCP 协议，它在 1995 年的时候就创立出来了，到现在都没有大改，依旧服务了各种各样的场景。Nginx 也是一样，从 2014 年推出来后基本没多大变化。但它的模块化，是纵向的划分的架构，最底层是事件驱动，基于 EP 的事件驱动，再上面是 HTTP 框架，再上面是 HTTP 模块，再上面是 OpenResty 的 lua。再看横向的划分，比如说我们要做一些 WAF 防火墙的限制，又比如基于 IP 做白名单、黑名单，那它的模块划分很清楚，还比如其他的模块，像 linit 或者 Request 只负责限速，不会自己去获取到用户的真实 IP 再去限速等等。

所以，我说 Nginx 是一个好的架构，而我们学习 Nginx，也可以获取到非常好的架构思维。



学习 Nginx 有哪些好书推荐？

我认为有三个知识点一定要学：

1、**第一个知识就是 HTTP 学习，《HTTP 权威指南》是一本很好的书**；

2、**第二个是 TCP 协议一定要学习**，因为 Nginx 在处理的是性能，所以我们一定要了解 TCP 协议。**有一本书叫《TCP/IP 详解卷一：协议》**，其实它有三卷，第二卷、第三卷比较长，大家如果没有时间就不要看了。但大家一定要看卷一，重点是看 TCP 协议，大概也就是八、九章的样子。

3、**第三个是一定要了解 Linux 的内核**。大定不要一听到内核就觉得好恐怖啊，推荐一本书叫**《深入理解 Linux 内核》**，这本书对于前端同学来说，就比较恐怖了，学起来会非常的吃力，甚至一些后端同学第一次学也会感到吃力。

我再推荐一本书，叫做**《Lniux 内核设计与实现》**，讲的是比较浅，但一定要从第一章开始看，从进程、内存开始讲。你大概看完一半的时候，就会对一套体系非常的熟悉了。

其实，如果你真的要学 Nginx 的话，我首要推荐的是一个英文网站：**Nginx.org**。

虽然不是中文，但大家不要怕，因为网站上没有什么大段的内容，就是一个一个分析它的指令，大部分指令还是讲的很到位的。

但总而言之，对于 Nginx 学习者来说，吃透这个网站是很重要的。

**第二个是 Nginx.com**，里面有个板块内容叫 Blog，有很多很好的文章，推荐大家好好看看。还有就是关于 Nginx 一些新特性之类的文章，也一定要看。

**第三个就是《深入理解 Nginx；模块开发与架构解析》**。这本书主要讲的是模块开发，因为我当时工作要写模块开发，但市面上没有任何一本书来讲模块开发，于是就有了这本书。我为了讲清楚模块开发，又讲了一些架构的东西，这个是有参考意义的。但我建议大家一定要先看完《HTTP 权威指南》、《Linux 内核设计与实现》，再去看这本书，会更容易轻松一点。